<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>발간논문(아카이브) | Social Business Review</title>
  <link rel="stylesheet" href="/assets/styles.css">
  <meta name="description" content="SBR 발간논문 아카이브">
  <style>
    /* ---- Minimal, page-local design upgrade (no global changes) ---- */
    .wrap{max-width:1140px;margin:40px auto;padding:0 16px}
    /* Subnav (inline, page-only) */
    .sbr-subnav{display:flex;flex-wrap:wrap;gap:8px;margin:8px 0 24px 0}
    .sbr-subnav a{display:inline-block;padding:8px 12px;border:1px solid #e5e5e5;border-radius:9999px;
      text-decoration:none;color:#111;background:#fff;transition:.15s}
    .sbr-subnav a:hover{transform:translateY(-1px)}
    .sbr-subnav a[aria-current="page"]{background:#111;color:#fff;border-color:#111}
    /* Archive sections */
    .vol{margin:28px 0 36px 0}
    .vol-hd{display:flex;align-items:baseline;gap:12px;margin:0 0 12px 0;border-bottom:1px solid #eee;padding-bottom:8px}
    .vol-hd h2{margin:0;font-size:1.15rem}
    .vol-hd .count{color:#666;font-size:.95rem}
    /* Cards grid */
    .grid{display:grid;grid-template-columns:repeat(auto-fill, minmax(420px, 1fr));gap:18px;align-items:start}
    .card{border:1px solid #eee;border-radius:14px;padding:16px;background:#fff}
    .card h3{margin:.2rem 0 .4rem 0;font-size:1.05rem;line-height:1.5}
    .card .authors{font-size:.95rem;color:#555;margin-bottom:4px}
    .card .meta{font-size:.9rem;color:#777}
    .card .actions{margin-top:8px}
    .card .actions a{display:inline-block;margin-right:12px;font-size:.92rem;text-decoration:none;border-bottom:1px dashed #aaa}
    @media (max-width: 520px){ .grid{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <main class="wrap">
    <header>
      <h1>발간논문(아카이브)</h1>
      <!-- Inline subnav (only this page; no global files touched) -->
      <nav class="sbr-subnav" aria-label="SBR navigation">
        <a href="/">홈</a>
        <a href="/sbr/">SBR 홈</a>
        <a href="/sbr/editorial-policy">편집규정</a>
        <a href="/sbr/ethics">윤리헌장</a>
        <a href="/sbr/peer-review">심사절차</a>
        <a href="/sbr/call-for-papers">투고 안내</a>
        <a href="/sbr/archive" aria-current="page">아카이브</a>
      </nav>
    </header>

    <section id="pubs-archive"></section>
  </main>

  <script>
  (function(){
    const root = document.getElementById('pubs-archive');
    function T(v){ return (v==null?'':String(v)).trim(); }
    function N(v){ const n = Number((v||'').toString().replace(/[^0-9.]/g,'')); return Number.isFinite(n)?n:null; }
    function authorsToText(a){
      if (!a) return '';
      if (Array.isArray(a)) return a.map(x => (typeof x==='string'?x:(x.name||''))).filter(Boolean).join(', ');
      return String(a||'');
    }
    function groupKey(it){ return [T(it.volume||it.vol), T(it.issue||it.no||it.number), T(it.year||it.date||'')].join('|'); }
    function groupTitle(v,i,y){
      const parts=[]; if(v) parts.push('Vol.'+v); if(i) parts.push('No.'+i);
      return y ? parts.join(' ') + ' ('+y+')' : (parts.join(' ')||'기타');
    }
    function sortGroups(a,b){
      const [va,ia,ya]=a.key.split('|'); const [vb,ib,yb]=b.key.split('|');
      const yaN=N(ya)??-1, ybN=N(yb)??-1; if(yaN!==ybN) return ybN-yaN;
      const vaN=N(va)??-1, vbN=N(vb)??-1; if(vaN!==vbN) return vbN-vaN;
      const iaN=N(ia)??-1, ibN=N(ib)??-1; return ibN-iaN;
    }
    function render(entries){
      if (!root) return;
      root.innerHTML='';
      // clean demo texts if any (cache defense)
      Array.from(document.querySelectorAll('h2,h3,p')).forEach(n=>{
        const t=(n.textContent||'').replace(/\s+/g,' ').trim();
        if (/발간논문.*Archive/i.test(t) || /Vol\.?\s*1.*No\.?\s*1/i.test(t)) n.remove();
      });
      const map=new Map();
      (entries||[]).forEach(it=>{ const k=groupKey(it); if(!map.has(k)) map.set(k,[]); map.get(k).push(it); });
      const groups=Array.from(map.entries()).map(([key,items])=>({key,items})).sort(sortGroups);
      groups.forEach(g=>{
        const [v,i,y]=g.key.split('|');
        const sec=document.createElement('section'); sec.className='vol';
        sec.innerHTML = '<div class="vol-hd"><h2>' + groupTitle(v,i,y) + '</h2>' +
                        '<div class="count">' + g.items.length + '편</div></div>' +
                        '<div class="grid"></div>';
        const grid = sec.querySelector('.grid');
        g.items.forEach(it=>{
          const title=T(it.title||it.paper_title||'제목 미정');
          const authors=authorsToText(it.authors);
          const doi=T(it.doi);
          const year=T(it.year);
          const pdf=T(it.pdf||it.file||(it.attachments&&it.attachments[0]&&it.attachments[0].url));
          const card=document.createElement('article'); card.className='card';
          card.innerHTML = '<h3>'+title+'</h3>' +
                           (authors?'<div class="authors">'+authors+'</div>':'') +
                           '<div class="meta">'+[doi?('DOI: <span>'+doi+'</span>'):'', year].filter(Boolean).join(' · ')+'</div>' +
                           '<div class="actions">'+(pdf?'<a href="'+pdf+'" target="_blank" rel="noopener">PDF</a>':'')+'</div>';
          grid.appendChild(card);
        });
        root.appendChild(sec);
      });
    }

    async function init(){
      try{
        const res = await fetch('/assets/data/pubs.json', { cache:'no-store' });
        if(res.ok){
          const data = await res.json();
          const entries = (data && (data.entries||data)) || [];
          if(Array.isArray(entries) && entries.length){ render(entries); return; }
        }
      }catch(e){/*silent*/}

      // Fallback: if page already rendered items somewhere else, pull them
      const found = Array.from(document.querySelectorAll('article.paper'));
      if(found.length){
        const entries = found.map(n => ({
          title:(n.querySelector('h4, h3, .title')||{}).textContent||'',
          authors:(n.querySelector('.authors, .byline')||{}).textContent||'',
          pdf:(n.querySelector('a[href$=".pdf"]')||{}).getAttribute ? (n.querySelector('a[href$=".pdf"]').getAttribute('href') || '') : ''
        }));
        render(entries);
      }
    }
    if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded', init, {once:true});} else {init();}
  })();
  </script>
</body>
</html>

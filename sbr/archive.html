<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>발간저널(아카이브) | Social Business Review</title>
  <link rel="stylesheet" href="/assets/styles.css">
  <style>
    /* 최소 변경: 중앙 메인 영역만 넓게 보이도록 */
    .archive-wrap{max-width:1100px;margin:40px auto;padding:0 16px}
    .archive-grid{display:grid;grid-template-columns:1fr;gap:24px}
    @media (min-width: 960px){
      .archive-grid{grid-template-columns: 1fr}
    }
    #pubs-archive{min-height:200px}
    #pubs-archive .paper-list{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap:18px;
      align-items:start;
    }
    .paper-card{
      border:1px solid #eee;border-radius:14px;padding:16px;background:#fff
    }
    .paper-card h4{margin:.2rem 0 .4rem 0;font-size:1rem}
    .paper-card .meta{font-size:.9rem;color:#666;margin-bottom:.4rem}
    .paper-card .actions a{display:inline-block;margin-right:10px;font-size:.9rem;text-decoration:none;border-bottom:1px dashed #aaa}
    .muted{color:#666}
  </style>
</head>
<body>
  <main class="archive-wrap">
    <header>
      <h1>발간저널(아카이브)</h1>
      <p class="muted">관리자에서 등록한 최신 논문이 가운데 영역에 표시됩니다.</p>
    </header>

    <section class="archive-grid">
      <!-- 중앙 메인 렌더 타겟 -->
      <div id="pubs-archive">
        <div class="paper-list" aria-live="polite"></div>
      </div>
    </section>
  </main>

  <script>
  (function(){
    // 1) 페이지 어딘가에 이미 렌더된 항목(예: 좌측 하단의 article.paper)이 있으면 중앙으로 "이동"
    function moveFromExisting(){
      const centerList = document.querySelector('#pubs-archive .paper-list');
      if (!centerList) return false;
      const found = Array.from(document.querySelectorAll('article.paper'));
      if (found.length){
        // 기존 DOM에서 중앙으로 이동 (중복 표시 방지)
        found.forEach(node => {
          try{
            centerList.appendChild(node);
            // 카드 스타일이 없을 수 있으니 최소 래퍼 적용
            if (!node.classList.contains('paper-card')) node.classList.add('paper-card');
          }catch(_){}
        });
        return true;
      }
      return false;
    }

    // 2) 기존 요소가 없다면, 데이터 파일에서 직접 렌더 (기존 구조는 손대지 않음)
    async function renderFromJSON(){
      const centerList = document.querySelector('#pubs-archive .paper-list');
      if (!centerList) return;
      try{
        const res = await fetch('/assets/data/pubs.json', { cache:'no-store' });
        if (!res.ok) return;
        const data = await res.json();
        const entries = (data && (data.entries || data)) || [];
        if (!Array.isArray(entries) || !entries.length) return;

        entries.forEach(it => {
          const title = it.title || '제목 미정';
          const authors = Array.isArray(it.authors)
            ? it.authors.map(a => (typeof a === 'string' ? a : (a.name||''))).filter(Boolean).join(', ')
            : (it.authors || '');
          const volno = [it.volume, it.issue].filter(Boolean).join(' / ');
          const year = it.year || '';
          const pdf = it.pdf || it.file || (it.attachments && it.attachments[0] && it.attachments[0].url) || '';
          const li = document.createElement('article');
          li.className = 'paper-card';
          li.innerHTML = `
            <h4>${title}</h4>
            <div class="meta">${[authors, volno, year].filter(Boolean).join(' · ')}</div>
            <div class="actions">
              ${pdf ? `<a href="${pdf}" target="_blank" rel="noopener">PDF 열기</a>` : ''}
            </div>
          `;
          centerList.appendChild(li);
        });
      }catch(e){ /* silent */ }
    }

    function init(){
      if (!moveFromExisting()){
        // 좌측 하단 렌더가 지연될 수 있으므로 잠깐 관찰하다가 없으면 JSON으로 채움
        const obs = new MutationObserver(() => {
          if (moveFromExisting()){
            obs.disconnect();
          }
        });
        obs.observe(document.documentElement, { childList:true, subtree:true });
        // 1.2초 내에 못 찾으면 JSON으로 직접 렌더
        setTimeout(() => { renderFromJSON(); obs.disconnect(); }, 1200);
      }
    }

    if (document.readyState === 'loading'){
      document.addEventListener('DOMContentLoaded', init, { once:true });
    } else {
      init();
    }
  })();
  </script>
</body>
</html>

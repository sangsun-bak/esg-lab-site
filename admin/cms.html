<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CMS | ESG 경영연구소</title>
  <style>
    html,body{height:100%} body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,'Apple SD Gothic Neo','Noto Sans KR',sans-serif}
    .bar{display:flex;align-items:center;gap:12px;padding:10px 14px;border-bottom:1px solid #eee}
    .bar a{text-decoration:none;border:1px solid #ddd;border-radius:9999px;padding:8px 12px;color:#111}
    #cms{height:calc(100% - 50px)}
  </style>
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
</head>
<body>
  <div class="bar"><a href="/admin/">← 대시보드</a></div>
  <div id="cms"></div>

  <script>
  (function(){
    // 1) OAuth hash 정리 (새로고침 없이)
    function cleanupOAuthHashOnce(){
      const h = window.location.hash || "";
      if(h && (h.includes("access_token") || h.includes("provider") || h.includes("token"))){
        history.replaceState(null, "", window.location.pathname);
      }
    }
    cleanupOAuthHashOnce();

    // 2) Netlify Identity 이벤트: 재로드/리다이렉트 금지
    if(window.netlifyIdentity && netlifyIdentity.on){
      netlifyIdentity.on("login", function(){ /* stay */ });
      netlifyIdentity.on("logout", function(){ /* 선택적으로: location.assign('/admin/') */ });
    }

    // 3) CMS 초기화는 decap-cms 스크립트가 담당 (기본 동작)
    // 별도 리다이렉트/리로드 코드 없음
  })();
  </script>
</body>
</html>

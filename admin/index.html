<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>관리자 대시보드 | ESG 경영연구소</title>
  <link rel="stylesheet" href="/assets/styles.css">
  <style>
    :root { --gap:12px; }
    .adm-wrap{max-width:880px;margin:40px auto;padding:0 16px;}
    .adm-auth-controls{display:none;min-height:56px;align-items:center;gap:var(--gap);}
    .adm-auth-controls.visible{display:flex;}
    .adm-btn{padding:10px 14px;border-radius:9999px;border:1px solid #ddd;background:#fff;cursor:pointer}
    .adm-btn--primary{background:#111;color:#fff;border-color:#111}
    .adm-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:32px}
    .adm-card{border:1px solid #eee;border-radius:16px;padding:20px}
    .adm-card h3{margin-top:0}
  </style>
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js" defer></script>
</head>
<body>
  <div class="adm-wrap">
    <h1>관리자 대시보드</h1>
    <p>콘텐츠를 선택해 관리하세요</p>

    <div id="adm-auth" class="adm-auth-controls" aria-live="polite"></div>

    <div class="adm-grid">
      <section class="adm-card">
        <h3>소식 / 이벤트</h3>
        <p>공지, 이벤트, 파일 첨부 등을 게시합니다</p>
        <p>
          <a class="adm-btn adm-btn--primary" href="/admin/cms.html#/" rel="nofollow">관리 화면 열기</a>
          <a class="adm-btn" href="/news.html">사이트에서 보기</a>
        </p>
      </section>
      <section class="adm-card">
        <h3>발간저널 (아카이브)</h3>
        <p>권·호·논문, 초록/DOI/PDF 업로드를 관리합니다</p>
        <p>
          <a class="adm-btn adm-btn--primary" href="/admin/cms.html#/collections/research/entries" rel="nofollow">관리 화면 열기</a>
          <a class="adm-btn" href="/research.html">사이트에서 보기</a>
        </p>
      </section>
    </div>
  </div>

  <script>
  (function(){
    function $(s){return document.querySelector(s);}
    function el(tag, attrs={}, text){
      const n=document.createElement(tag);
      for(const k in attrs){ n.setAttribute(k, attrs[k]); }
      if(text) n.textContent=text;
      return n;
    }
    function render(user){
      const host=$("#adm-auth"); if(!host) return;
      host.innerHTML="";
      if(user){
        host.append(
          el("a",{href:"/admin/cms.html",class:"adm-btn adm-btn--primary"},"관리자 열기"),
          el("button",{class:"adm-btn",id:"adm-logout"},"로그아웃")
        );
        $("#adm-logout").onclick=()=>netlifyIdentity.logout();
      }else{
        host.append(
          el("button",{class:"adm-btn adm-btn--primary",id:"adm-login"},"로그인"),
          el("a",{href:"/",class:"adm-btn"},"홈으로")
        );
        $("#adm-login").onclick=()=>netlifyIdentity.open();
      }
      host.classList.add("visible");
    }

    let inited=false;
    function init(){
      if(inited) return; inited=true;
      // 초기 사용자 상태로 렌더
      try{
        render(netlifyIdentity.currentUser && netlifyIdentity.currentUser());
      }catch(e){ /* 위젯 미로드 시에도 렌더는 수행 */ }
      // 위젯 이벤트 구독 (중복 방지)
      if(window.netlifyIdentity && netlifyIdentity.on){
        netlifyIdentity.on("init", render);
        netlifyIdentity.on("login", () => render(netlifyIdentity.currentUser()));
        netlifyIdentity.on("logout", () => render(null));
      }
    }
    if(document.readyState === "loading"){
      document.addEventListener("DOMContentLoaded", init, {once:true});
    }else{ init(); }
  })();
  </script>
</body>
</html>
